<form class="container overflow-hidden" #personForm="ngForm" (ngSubmit)="save()">
  <h1>{{(isNew && !person.FirstName && !person.LastName ? 'New Person' : person.firstName + ' ' + person.lastName)}}</h1>

  <div class="form-group">
    <div class="image-container col-sm-4">
      <img *ngIf="safeUrl" class="img-fluid img-thumbnail" id="image" [src]="safeUrl">
    </div>
    <div class="input-group mb-3">
      <div class="input-group-prepend">
        <span class="input-group-text">Choose an image</span>
      </div>
      <div class="custom-file">
        <input type="file" class="custom-file-input" id="imageInput" accept="image/*"
               (change)="processImage(imageInput)" name="imageInput" #imageInput>
        <label class="custom-file-label" for="image">{{image ? image.name : 'Choose image'}}</label>
      </div>
    </div>
  </div>

  <div class="form-group row">
    <label class="col-sm-2 col-form-label" for="firstName">First name</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" id="firstName"
             required maxlength="50"
             [(ngModel)]="person.firstName" name="firstName" #firstName="ngModel">

      <div *ngIf="firstName.invalid && (firstName.dirty || firstName.touched)"
           class="alert alert-danger">
        <div *ngIf="firstName.errors.required">
          First name is required.
        </div>
        <div *ngIf="firstName.errors.maxLength">
          First name must be no more than 50 characters long.
        </div>
      </div>
    </div>
  </div>

  <div class="form-group row">
    <label class="col-sm-2 col-form-label" for="lastName">Last name</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" id="lastName"
             required maxlength="50"
             [(ngModel)]="person.lastName" name="lastName" #lastName="ngModel">

      <div *ngIf="lastName.invalid && (lastName.dirty || lastName.touched)"
           class="alert alert-danger">
        <div *ngIf="lastName.errors.required">
          Last name is required.
        </div>
        <div *ngIf="lastName.errors.maxLength">
          Last name must be no more than 50 characters long.
        </div>
      </div>

    </div>
  </div>

  <div class="form-group row">
    <label class="col-sm-2 col-form-label" for="birthDate">Birth date</label>
    <div class="col-sm-10">
      <input type="date" class="form-control date-picker" id="birthDate"
             required
             [ngModel]="person.birthDate | date:'yyyy-MM-dd'" (ngModelChanged)="person.birthDate = $event" name="birthDate" #birthDate="ngModel">

      <div *ngIf="birthDate.invalid && (birthDate.dirty || birthDate.touched)"
           class="alert alert-danger">
        <div *ngIf="birthDate.errors.required">
          Birth date is required.
        </div>
      </div>

    </div>
  </div>

  <div class="form-group row">
    <label class="col-sm-2 col-form-label" for="deathDate">Death date</label>
    <div class="col-sm-10">
      <input type="date" class="form-control date-picker" id="deathDate"
             [ngModel]="person.deathDate | date:'yyyy-MM-dd'" (ngModelChanged)="person.deathDate = $event" name="deathDate" #deathDate="ngModel">

      <div *ngIf="lastName.invalid && (lastName.dirty || lastName.touched)"
           class="alert alert-danger">
      </div>

    </div>
  </div>

  <div class="form-group">
    <h2 for="Address">Address</h2>
    <app-address-form [address]="person.address" (onValidationChanged)="onValidationChanged.emit($event)" #addressForm></app-address-form>
  </div>
  <div class="form-group">
    <h2 for="interests">Interests</h2>
    <app-interests-form [interests]="person.interests"></app-interests-form>
  </div>

  <div class="btn-group float-right">
    <button class="btn btn-outline-primary" type="submit" title="save person" [disabled]="!isValid" *ngIf="!isSaving">
      Save
    </button>
    <button type="submit" class="btn btn-outline-primary" title="saving..." [disabled]="isSaving" *ngIf="isSaving">
      <i class="fas fa-spinner fa-spin"></i>
    </button>
    <button class="btn btn-outline-secondary" title="go back" (click)="goBack()">{{(isNew ? 'Cancel' : 'Go Back')}}</button>
  </div>
</form>
